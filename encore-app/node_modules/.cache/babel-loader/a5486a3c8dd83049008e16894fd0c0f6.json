{"ast":null,"code":"import _classCallCheck from \"/Users/conley/Desktop/Projects/encore/encore-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/conley/Desktop/Projects/encore/encore-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/conley/Desktop/Projects/encore/encore-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/conley/Desktop/Projects/encore/encore-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/conley/Desktop/Projects/encore/encore-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/conley/Desktop/Projects/encore/encore-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/conley/Desktop/Projects/encore/encore-app/src/pages/queue.js\";\nimport React, { Component } from 'react';\nimport { Link, Redirect } from 'react-router-dom';\nimport Grid from \"@material-ui/core/es/Grid/Grid\";\nimport SimpleTable from '../components/simple-table';\nimport NowPlayingCard from '../components/now-playing';\nimport { pink, THEME } from \"../encore-theme\";\nimport MuiThemeProvider from \"@material-ui/core/es/styles/MuiThemeProvider\";\nimport { withStyles } from \"@material-ui/core/styles/index\";\nimport { toRenderProps } from \"recompose\";\nimport withWidth from \"@material-ui/core/es/withWidth/withWidth\";\n\nvar axios = require('axios');\n\nvar styles = function styles(theme) {\n  return {\n    queue: {\n      color: pink,\n      fontFamily: \"Bowlby One SC\",\n      fontSize: 30,\n      textShadow: '5px 10px 18px rgba(0,0,0,0.2)'\n    },\n    cardHolder: {\n      maxWidth: '100%'\n    }\n  };\n};\n\nvar WithWidth = toRenderProps(withWidth());\n\nvar Queue =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Queue, _Component);\n\n  function Queue(props) {\n    var _this;\n\n    _classCallCheck(this, Queue);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Queue).call(this, props));\n\n    _this.handleVote = function (songObj, isUpvote) {\n      //takes in entire song object and handles whether it should be an upvote or downvote\n      var queryStr = '/songs';\n      var songID = songObj._id;\n      console.log(songID);\n      console.log(isUpvote);\n\n      if (isUpvote) {\n        queryStr += '/upvote/' + songID;\n        console.log(queryStr);\n        console.log(songObj);\n      } else {\n        queryStr += '/downvote/' + songID;\n        console.log(queryStr);\n        console.log(songObj);\n      }\n\n      axios.post(queryStr, songObj, {\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      }).then(function (res) {\n        return console.log(res.data);\n      }).catch(function (error) {\n        console.log('voting error: ');\n        console.log(error);\n      });\n      axios.get('/songs/' + songID).then(function (res) {\n        console.log(\"result:\");\n        console.log(res);\n\n        if (res.data.votes <= -5) {\n          axios.post('/songs/veto/' + songID, {\n            headers: {\n              'Content-Type': 'application/json'\n            }\n          }).then(function (res) {\n            console.log('Removed automatically: ' + songID);\n            console.log(res.data);\n          });\n        }\n      }).catch(function (err) {\n        console.log(\"Auto song removal error\");\n        console.error(err);\n      });\n\n      _this.reRender();\n    };\n\n    _this.handleVeto = function (songObj) {\n      var songID = songObj._id;\n      var queryStr = '/songs/veto/' + songID;\n      console.log(songID);\n      axios.post(queryStr, songObj, {\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      }).then(function (res) {\n        return console.log(res.data);\n      }).catch(function (error) {\n        console.log('veto error: ');\n        console.log(error);\n      });\n\n      _this.reRender();\n    };\n\n    _this.reRender = function () {\n      _this.getSongs();\n\n      _this.render();\n    };\n\n    _this.state = {\n      data: null,\n      currentSong: null\n    };\n    _this.getSongs = _this.getSongs.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.getCurrentSong = _this.getCurrentSong.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleVote = _this.handleVote.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleVeto = _this.handleVeto.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.reRender = _this.reRender.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(Queue, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getSongs(); // this.getCurrentSong();\n    }\n  }, {\n    key: \"getSongs\",\n    value: function getSongs() {\n      var _this2 = this;\n\n      //Get songs to be passed into the table - aka the songs that are in the queue\n      axios.get('/songs/').then(function (response) {\n        if (response.data) {\n          //Returns sorted list\n          var sorted = response.data.sort(function (a, b) {\n            return parseFloat(b.votes) - parseFloat(a.votes);\n          });\n\n          _this2.setState({\n            data: sorted\n          }, function () {\n            return _this2.getCurrentSong();\n          });\n\n          return sorted;\n        } else {\n          console.log('Get Song: failed');\n        }\n      });\n      setTimeout(this.getSongs, 1000);\n    }\n  }, {\n    key: \"getCurrentSong\",\n    value: function getCurrentSong() {\n      var currentSong = null; //todo: use spotify API to get the current song playing - then assign it to the currentSong variable to pass into the media card\n\n      if (this.state.data) {\n        currentSong = this.state.data[0]; //placeholder for now, just return the first object in the list\n      }\n\n      this.setState({\n        currentSong: currentSong\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      console.log(this.state.data);\n      var classes = this.props.classes; //prop if user is hosting session or joining session\n\n      var hosting = this.props;\n      var data = this.state.data;\n      var currentSong = this.state.currentSong;\n\n      if (this.state.data === null || this.state.currentSong === null) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 165\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 166\n          },\n          __self: this\n        }, \"loading\"));\n      }\n\n      return React.createElement(MuiThemeProvider, {\n        theme: THEME,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"host-queue\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }, React.createElement(Grid, {\n        container: true,\n        direction: \"row\",\n        justify: \"center\",\n        alignItems: \"center\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175\n        },\n        __self: this\n      }, React.createElement(Grid, {\n        item: true,\n        xs: 12,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181\n        },\n        __self: this\n      }, React.createElement(\"h2\", {\n        className: classes.queue,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182\n        },\n        __self: this\n      }, \"Welcome to the Party\")), React.createElement(Grid, {\n        className: classes.cardHolder,\n        item: true,\n        xs: 12,\n        sm: 4,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }, React.createElement(NowPlayingCard, {\n        imgUrl: currentSong.cover_art,\n        title: currentSong.title,\n        artist: currentSong.artist,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      })), React.createElement(Grid, {\n        item: true,\n        xs: 12,\n        sm: 8,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218\n        },\n        __self: this\n      }, React.createElement(WithWidth, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219\n        },\n        __self: this\n      }, function (_ref) {\n        var width = _ref.width;\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 220\n          },\n          __self: this\n        }, width === 'xs' && React.createElement(SimpleTable, {\n          isHost: hosting,\n          fetchedData: data,\n          handleVote: _this3.handleVote,\n          handleVeto: _this3.handleVeto,\n          reRender: _this3.reRender,\n          isMobile: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 222\n          },\n          __self: this\n        }), width !== 'xs' && React.createElement(SimpleTable, {\n          isHost: hosting,\n          fetchedData: data,\n          handleVote: _this3.handleVote,\n          handleVeto: _this3.handleVeto,\n          reRender: _this3.reRender,\n          isMobile: false,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 232\n          },\n          __self: this\n        }));\n      })))));\n    }\n  }]);\n\n  return Queue;\n}(Component);\n\nexport default withStyles(styles)(Queue);","map":{"version":3,"sources":["/Users/conley/Desktop/Projects/encore/encore-app/src/pages/queue.js"],"names":["React","Component","Link","Redirect","Grid","SimpleTable","NowPlayingCard","pink","THEME","MuiThemeProvider","withStyles","toRenderProps","withWidth","axios","require","styles","theme","queue","color","fontFamily","fontSize","textShadow","cardHolder","maxWidth","WithWidth","Queue","props","handleVote","songObj","isUpvote","queryStr","songID","_id","console","log","post","headers","then","res","data","catch","error","get","votes","err","reRender","handleVeto","getSongs","render","state","currentSong","bind","getCurrentSong","response","sorted","sort","a","b","parseFloat","setState","setTimeout","classes","hosting","cover_art","title","artist","width"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport {Link, Redirect} from 'react-router-dom'\nimport Grid from \"@material-ui/core/es/Grid/Grid\";\nimport SimpleTable from '../components/simple-table';\nimport NowPlayingCard from '../components/now-playing';\nimport {pink, THEME} from \"../encore-theme\";\nimport MuiThemeProvider from \"@material-ui/core/es/styles/MuiThemeProvider\";\nimport {withStyles} from \"@material-ui/core/styles/index\";\nimport {toRenderProps} from \"recompose\";\nimport withWidth from \"@material-ui/core/es/withWidth/withWidth\";\n\nconst axios = require('axios');\n\n\nconst styles = theme => ({\n    queue: {\n        color: pink,\n        fontFamily:  \"Bowlby One SC\",\n        fontSize: 30,\n        textShadow: '5px 10px 18px rgba(0,0,0,0.2)',\n    },\n    cardHolder: {\n        maxWidth: '100%',\n    }\n});\n\nconst WithWidth = toRenderProps(withWidth());\n\nclass Queue extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            data: null,\n            currentSong: null,\n        }\n        this.getSongs = this.getSongs.bind(this)\n        this.getCurrentSong = this.getCurrentSong.bind(this)\n        this.handleVote = this.handleVote.bind(this)\n        this.handleVeto = this.handleVeto.bind(this)\n        this.reRender = this.reRender.bind(this)\n    }\n\n    componentDidMount(){\n        this.getSongs();\n        // this.getCurrentSong();\n    }\n\n     getSongs() {\n        //Get songs to be passed into the table - aka the songs that are in the queue\n        axios.get('/songs/')\n        .then(response => {\n        if (response.data) {\n            //Returns sorted list\n            var sorted = response.data.sort(function(a, b) {\n                return parseFloat(b.votes) - parseFloat(a.votes);\n            });\n            this.setState({\n                data: sorted\n            }, () => this.getCurrentSong());\n            return sorted;\n        } else {\n            console.log('Get Song: failed');\n        }\n        })\n\n         setTimeout(this.getSongs, 1000);\n    }\n\n    getCurrentSong() {\n        let currentSong = null;\n        //todo: use spotify API to get the current song playing - then assign it to the currentSong variable to pass into the media card\n\n        if (this.state.data){\n            currentSong = this.state.data[0]; //placeholder for now, just return the first object in the list\n        }\n\n        this.setState({\n            currentSong: currentSong\n        })\n    }\n\n    handleVote = (songObj, isUpvote) => {\n        //takes in entire song object and handles whether it should be an upvote or downvote\n        let queryStr = '/songs';\n        const songID = songObj._id;\n        console.log(songID);\n        console.log(isUpvote);\n\n        if (isUpvote){\n            queryStr += '/upvote/' + songID\n            console.log(queryStr)\n            console.log(songObj)\n        }\n        else{\n            queryStr += '/downvote/' + songID\n            console.log(queryStr)\n            console.log(songObj)\n        }\n\n        axios.post(queryStr, songObj,{\n            headers: {'Content-Type': 'application/json',}\n        })\n            .then(res => console.log(res.data))\n            .catch(error => {\n                console.log('voting error: ')\n                console.log(error)\n            });\n\n        axios.get('/songs/' + songID).then(res => {\n            console.log(\"result:\");\n            console.log(res);\n            if (res.data.votes <= -5) {\n                axios.post('/songs/veto/' + songID, {\n                    headers: {'Content-Type': 'application/json',}\n                }).then(res => {\n                    console.log('Removed automatically: ' + songID);\n                    console.log(res.data)\n                });\n            }\n        }).catch(err => {\n            console.log(\"Auto song removal error\");\n            console.error(err);\n            }\n        );\n\n        this.reRender();\n    }\n\n    handleVeto = (songObj) => {\n        const songID = songObj._id;\n        const queryStr = '/songs/veto/' + songID;\n        console.log(songID);\n\n\n        axios.post(queryStr, songObj,{\n            headers: {'Content-Type': 'application/json',}\n        })\n            .then(res => console.log(res.data))\n            .catch(error => {\n                console.log('veto error: ')\n                console.log(error)\n            });\n        this.reRender();\n    }\n\n    reRender = () => {\n        this.getSongs();\n        this.render();\n    }\n\n    render() {\n\n        console.log(this.state.data)\n\n        const { classes } = this.props;\n\n        //prop if user is hosting session or joining session\n        const hosting = this.props;\n\n        const data = this.state.data;\n        const currentSong = this.state.currentSong\n\n        if (this.state.data === null || this.state.currentSong === null){\n            return(\n                <div>\n                    <p>loading</p>\n                </div>\n            )\n        }\n        return (\n\n            <MuiThemeProvider theme={THEME}>\n\n                <div className=\"host-queue\">\n                    <Grid\n                        container\n                        direction=\"row\"\n                        justify=\"center\"\n                        alignItems=\"center\"\n                    >\n                        <Grid item xs={12}>\n                                <h2 className={classes.queue}>Welcome to the Party</h2>\n                        </Grid>\n                        <Grid className={classes.cardHolder} item xs={12} sm={4}>\n                            <NowPlayingCard\n                                imgUrl={currentSong.cover_art}\n                                title={currentSong.title}\n                                artist={currentSong.artist}\n                            />\n                        </Grid>\n                        {/*<Grid className={classes.cardHolder} item xs={12} sm={4}>*/}\n                            {/*<WithWidth>*/}\n                                    {/*{({ width }) => <div>*/}\n                                        {/*{width === 'xs' &&*/}\n                                        {/*<Grid className={classes.cardHolder} item xs={12} sm={4}>*/}\n                                            {/*<NowPlayingCard*/}\n                                                    {/*imgUrl={currentSong.cover_art}*/}\n                                                    {/*title={currentSong.title}*/}\n                                                    {/*artist={currentSong.artist}*/}\n                                                    {/*isMobile={true}*/}\n                                                {/*/>*/}\n                                        {/*</Grid>*/}\n                                        {/*}*/}\n                                        {/*{width !== 'xs' &&*/}\n                                        {/*<Grid className={classes.cardHolder} item xs={12} sm={4}>*/}\n                                            {/*<NowPlayingCard*/}\n                                                    {/*imgUrl={currentSong.cover_art}*/}\n                                                    {/*title={currentSong.title}*/}\n                                                    {/*artist={currentSong.artist}*/}\n                                                    {/*isMobile={false}*/}\n                                                {/*/>*/}\n                                        {/*</Grid>*/}\n                                        {/*}*/}\n\n                                    {/*</div>}*/}\n                            {/*</WithWidth>*/}\n                        {/*</Grid>*/}\n                        <Grid item xs={12} sm={8}>\n                            <WithWidth>\n                                {({ width }) => <div>\n                                    {width === 'xs' &&\n                                        <SimpleTable\n                                            isHost={hosting}\n                                            fetchedData={data}\n                                            handleVote={this.handleVote}\n                                            handleVeto={this.handleVeto}\n                                            reRender={this.reRender}\n                                            isMobile={true}\n                                        />\n                                    }\n                                    {width !== 'xs' &&\n                                        <SimpleTable\n                                            isHost={hosting}\n                                            fetchedData={data}\n                                            handleVote={this.handleVote}\n                                            handleVeto={this.handleVeto}\n                                            reRender={this.reRender}\n                                            isMobile={false}\n                                        />\n                                    }\n                                </div>}\n                            </WithWidth>\n                        </Grid>\n                    </Grid>\n                </div>\n            </MuiThemeProvider>\n        )\n    }\n}\n\n\nexport default withStyles(styles)(Queue);\n"]},"metadata":{},"sourceType":"module"}